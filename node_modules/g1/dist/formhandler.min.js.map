{"version":3,"file":"formhandler.min.js","sources":["../src/url.js","../src/namespace_util.js","../src/types.js","../src/datafilter.js","../src/formhandler.js","../src/_util.js","../src/urlfilter.js","../index-urlfilter.js","../index-formhandler.js","../src/package.js"],"sourcesContent":["/*\n  url.parse() provides results consistent with window.location.\n\n  0 href                Full URL source\n  1 protocol            http, https, etc\n  2 origin              username:password@hostname:port\n  4 username            username\n  5 password            password\n  - host                NOT IMPLEMENTED\n  6 hostname            hostname\n  7 port                port\n  9 pathname            full path, excluding hash\n  12 search              search parameters\n  13 hash                url fragment\n\n  The following are not part of window.location, but provided anyway.\n\n  3 userinfo            username:password\n  8 relative:           Everything after origin\n  10 directory:          Directory part of pathname\n  11 file:               File part of pathname\n    - searchKey           search as an ordered dict of strings\n    - searchList          search as an ordered dict of arrays\n  */\n\nvar\n    _url_parse_key    = ['href','protocol','origin','userinfo','username','password','hostname','port','relative','pathname','directory','file','search','hash'],\n    _url_parse_qname  = ['searchKey', 'searchList'],\n    _url_parse_strict = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,  // eslint-disable-line\n    _url_parse_search = /(?:^|&)([^&=]*)=?([^&]*)/g\n\nvar _decode_uri_component = function(s) { return decodeURIComponent(s.replace(/\\+/g, '%20')) },\n    _encode_uri_component = encodeURIComponent\n\nexport function parse(str) {\n  /* Based on parseUri 1.2.2: http://blog.stevenlevithan.com/archives/parseuri\n    MIT License\n  */\n  var uri = {\n        toString: unparse,\n        join: join,\n        update: update\n      },\n      m   = _url_parse_strict.exec(str || ''),\n      i   = 14\n\n  while (i--) uri[_url_parse_key[i]] = m[i] || ''\n\n  var search_key = uri[_url_parse_qname[0]] = {},\n      search_list = uri[_url_parse_qname[1]] = {}\n  uri[_url_parse_key[12]].replace(_url_parse_search, function ($0, key, val) {\n    if (key) {\n      key = _decode_uri_component(key)\n      val = _decode_uri_component(val)\n      search_key[key] = val\n      search_list[key] = search_list[key] || []\n      search_list[key].push(val)\n    }\n  })\n\n  return uri\n}\n\n\n// Converts the URL parts back into the original URL.\nexport function unparse(self) {\n  self = self || this\n  var protocol    = self[_url_parse_key[1]] || 'http',\n      username    = self[_url_parse_key[4]],\n      password    = self[_url_parse_key[5]],\n      hostname    = self[_url_parse_key[6]],\n      port        = self[_url_parse_key[7]],\n      pathname    = self[_url_parse_key[9]],\n      search      = self[_url_parse_key[12]],\n      hash        = self[_url_parse_key[13]],\n      search_key  = self[_url_parse_qname[0]],\n      search_list = self[_url_parse_qname[1]],\n      parts = hostname ? [protocol, '://'] : [],\n      qparts = [],\n      key, vals, i, l\n  if (username) {\n    parts.push(username)\n    if (password) parts.push(':', password)\n    parts.push('@')\n  }\n  parts.push(hostname)\n  if (port) parts.push(':', port)\n  parts.push(pathname || (hostname ? '/' : ''))\n  if (search) {\n    parts.push('?', search)\n  } else {\n    if (search_list) {\n      for (key in search_list) {\n        for (i=0, vals=search_list[key], l=vals.length; i<l; i++) {\n          qparts.push(_encode_uri_component(key) + '=' + _encode_uri_component(vals[i]))\n        }\n        if (!l) qparts.push(key)\n      }\n    } else if (search_key) {\n      for (key in search_key) {\n        qparts.push(_encode_uri_component(key) + '=' + _encode_uri_component(search_key[key]))\n      }\n    }\n    if (qparts.length) parts.push('?', qparts.join('&'))\n  }\n  if (hash) parts.push('#', hash)\n\n  return parts.join('')\n}\n\n\nexport function join(urlstr, options) {\n  options = options || {}\n  var self = this,\n      sources = self[_url_parse_key[9]].split('/'), // self.pathname.split\n      ptr     = sources.length - 1,                 // Points to last element\n      url     = parse(urlstr),\n      targets = url.pathname.split('/'),\n      l       = targets.length,\n      i,\n      frag\n\n  if (typeof options.query == 'undefined')\n    options.query = true\n  if (typeof options.hash == 'undefined')\n    options.hash = true\n\n  for (i=0; i<14; i++) {\n    if (i == 9) continue                      // Ignore path\n    if (i == 12 && !options.query) continue   // Ignore search parameters\n    if (i == 13 && !options.hash) continue    // Ignore url fragment\n    if (url[_url_parse_key[i]]) self[_url_parse_key[i]] = url[_url_parse_key[i]]\n  }\n  if (options.query && url[_url_parse_key[12]]) {  // Copy search parameters\n    self[_url_parse_qname[0]] = url[_url_parse_qname[0]]\n    self[_url_parse_qname[1]] = url[_url_parse_qname[1]]\n  }\n  for (i=0; i < l; i++) {\n    frag = targets[i]\n    if (frag == '.') {\n      sources[ptr] = ''\n    } else if (frag == '..') {\n      sources[--ptr] = ''\n    } else if (frag === '') {\n      // Ignore blank urlstr\n      if (l > 1) {\n        // Leading slash clears the URL\n        if (!i) {\n          sources[0] = frag\n          ptr = 1\n        }\n        // Trailing slash is appended\n        if (i == l - 1) sources[ptr] = frag\n      }\n    } else {\n      sources[ptr] = frag\n      if (i < l - 1) ptr++\n    }\n  }\n\n  // Set .pathname, .directory, .file.\n  var path = self[_url_parse_key[9]] = sources.slice(0, ptr + 1).join('/'),\n      parts = path.split(/\\//),\n      relative = [path]\n  if (self[_url_parse_key[12]]) relative.push('?', self[_url_parse_key[12]])\n  if (self[_url_parse_key[13]]) relative.push('#', self[_url_parse_key[13]])\n  self[_url_parse_key[8]] = relative.join('')   // relative\n  self[_url_parse_key[10]] = parts.slice(0, parts.length - 1).join('/') + '/'   // directory\n  self[_url_parse_key[11]] = parts[parts.length - 1]  // file\n\n  return self\n}\n\n\nexport function update(args, mode) {\n  var self = this,\n      search_key = self[_url_parse_qname[0]],\n      search_list = self[_url_parse_qname[1]],\n      qparts = [],\n      modes = {},\n      key, val, i, l, hash, search_list_key, result\n\n  if (mode) {\n    // Ensure that mode is a string\n    mode = '' + mode\n    // If the mode is like a=add&b=toggle, treat it like URL search params and\n    // convert it into a dictionary\n    if (mode.match(/[&=]/))\n      modes = parse('?' + mode).searchKey\n    // If the mode is just a string like add, del, toggle, apply it to all keys\n    else\n      for (key in args)\n        modes[key] = mode\n  }\n\n  for (key in args) {\n    val = args[key]\n    if (val === null) {\n      search_list[key] = []\n    } else {\n      if (!Array.isArray(val)) val = [val]\n      if (!modes[key])\n        search_list[key] = val\n      else {\n        // Ensure that search_list[key] exists\n        if (!(key in search_list)) search_list[key] = []\n\n        // Prepare a hash for lookup\n        for (hash={}, i=0, l=val.length; i<l; i++)\n          hash[val[i].toString()] = 1\n\n        // Ensure that mode is a string\n        mode = '' + modes[key]\n\n        if (mode.match(/add/i))\n          search_list[key] = search_list[key].concat(val)\n\n        // mode=del deletes all matching values\n        else if (mode.match(/del/i)) {\n          for (result=[], search_list_key=search_list[key], i=0, l=search_list_key.length; i<l; i++) {\n            if (!hash[search_list_key[i]])\n              result.push(search_list_key[i])\n          }\n          search_list[key] = result\n        }\n\n        // mode=toggle deletes matching values, adds the rest\n        else if (mode.match(/toggle/i)) {\n          for (result=[], search_list_key=search_list[key], i=0, l=search_list_key.length; i<l; i++) {\n            if (hash[search_list_key[i]])\n              hash[search_list_key[i]] = 2 // Mark it as present\n            else\n              result.push(search_list_key[i])\n          }\n          // Append the unmarked values\n          for (val in hash)\n            if (hash[val] == 1)\n              result.push(val)\n          search_list[key] = result\n        }\n      }\n    }\n    if (search_list[key].length === 0) {\n      delete search_key[key]\n      delete search_list[key]\n    } else {\n      search_key[key] = search_list[key][search_list[key].length - 1]\n    }\n  }\n  for (key in search_list) {\n    val = search_list[key]\n    for (i=0, l=val.length; i<l; i++) {\n      qparts.push(_encode_uri_component(key) + '=' + _encode_uri_component(val[i]))\n    }\n  }\n  self.search = qparts.join('&')\n  return self\n}\n\n\nexport function namespace(search, name) {\n  // Return an object with all keys in search that begin with `<name>:` or\n  // do not have a `:` in them.\n  // If name is false-y, return search\n  if (!name)\n    return search\n  var result = {}\n  for (var key in search) {\n    var parts = key.split(':')\n    if (parts.length == 1)\n      result[parts[0]] = search[key]\n    else if (parts[0] === name)\n      result[parts[1]] = search[key]\n  }\n  return result\n}\n","export function namespace(search, name) {\n  // Return an object with all keys in search that begin with `<name>:` or\n  // do not have a `:` in them.\n  // If name is false-y, return search\n  if (!name)\n    return search\n  var result = {}\n  for (var key in search) {\n    var parts = key.split(':')\n    if (parts.length == 1)\n      result[parts[0]] = search[key]\n    else if (parts[0] === name)\n      result[parts[1]] = search[key]\n  }\n  return result\n}\n","// state_transition[old_state][current_type] -> new_state\n// type: undefined and type: null are mapped to state 'null', i.e. missing values\nvar state_transitions = {\n  'null': {\n    'null': { state: 'null' },\n    'date': { state: 'date' },\n    'number': { state: 'number' },\n    'boolean': { state: 'boolean' },\n    'string': { state: 'string' },\n    'object': { state: 'object' },\n    'mixed': { state: 'mixed', end: true }\n  },\n  'date': {\n    'null': { state: 'date' },\n    'undefined': { state: 'date' },\n    'date': { state: 'date' },\n    'default': { state: 'mixed', end: true }\n  },\n  'number': {\n    'null': { state: 'number' },\n    'undefined': { state: 'number' },\n    'number': { state: 'number' },\n    'default': { state: 'mixed', end: true }\n  },\n  'boolean': {\n    'null': { state: 'boolean' },\n    'undefined': { state: 'boolean' },\n    'boolean': { state: 'boolean' },\n    'default': { state: 'mixed', end: true }\n  },\n  'string': {\n    'null': { state: 'string' },\n    'undefined': { state: 'string' },\n    'string': { state: 'string' },\n    'default': { state: 'mixed', end: true }\n  },\n  'object': {\n    'null': { state: 'object' },\n    'object': { state: 'object' },\n    'undefined': { state: 'object' },\n    'default': { state: 'mixed', end: true }\n  },\n  'mixed': {\n    'default': { state: 'mixed', end: true }\n  }\n}\n\n\nexport function types(data, options) {\n  var result = {}\n  if (!data || !data.length)\n    return result\n\n  options = options || {}\n  options.convert = options.convert || false\n  options.limit = options.limit || 1000\n  var limit = (options.limit < data.length) ? options.limit : data.length\n  var ignore = options.ignore = options.ignore || [null, undefined]\n  var columns = Object.keys(data[0])\n\n  for (var columnIndex = 0; columnIndex < columns.length; columnIndex++) {\n    var column = columns[columnIndex]\n    var result_type = 'null'\n    for (var index = 0; index < limit; index++) {\n      var row = data[index]\n      var value = row[column]\n\n      if (columnIndex == 0) {\n        Object.keys(data[index]).forEach(function (value) {\n          if (columns.indexOf(value) == -1)\n            columns.push(value)\n        })\n      }\n\n      // Ignore if the value is missing\n      if (!(column in row))\n        continue\n      // Ignore values that are in the ignore list\n      if (ignore.indexOf(value) >= 0)\n        continue\n      // Identify type (date, object, number, boolean, string, undefined, null)\n      var type = typeof value\n      if (value === undefined || value === null)\n        type = 'null'\n      else if (type == 'object' && !isNaN(Date.parse(value)))\n        type = 'date'\n      else if (options.convert) {\n        // We use parseFloat AND isFinite because\n        // parseFloat('2018-01') is 2018 but isFinite('2018-01') is false\n        // Also, 'NaN', 'Infinity' and '-Infinity' should be treated as numbers\n        if ((!isNaN(parseFloat(value)) && isFinite(value)) || ['NaN', 'Infinity', '-Infinity'].indexOf(value) >= 0)\n          type = 'number'\n        else if (!isNaN(Date.parse(value)))\n          type = 'date'\n        else if (['true', 'false'].indexOf(value) != -1)\n          type = 'boolean'\n      }\n\n      // Apply the state change\n      var state_transition = state_transitions[type]\n      var change = state_transition[result_type] || state_transition['default']\n      result_type = change['state']\n      if (change['end'])\n        break\n    }\n    result[column] = result_type\n  }\n  return result\n}\n","import { namespace } from './namespace_util.js'\nimport { types } from './types.js'\n\nfunction isEqual(value, compare_with, criteria_satisfied) {\n  // to handle: ( ...Shape!&... ) or ( ...&Shape&... )\n  if (!value) {\n    return criteria_satisfied ? (compare_with == null) : (compare_with != null)\n  }\n  return value.indexOf(compare_with) != -1 ? !criteria_satisfied : criteria_satisfied\n}\n\nfunction greater_than(value, compare_with, include_equals) {\n  if ((isNaN(compare_with) && Date.parse(compare_with))) {\n    compare_with = Date.parse(compare_with)\n  }\n  if ((isNaN(value) && Date.parse(value))) {\n    value = Date.parse(value)\n  }\n  return include_equals ? (compare_with >= value) : (compare_with > value)\n}\nvar operators = {\n  '=': function (value, compare_with) {\n    return isEqual(value, compare_with, false)\n  },\n  '!': function (value, compare_with) {\n    return isEqual(value, compare_with, true)\n  },\n  '>': function (value, compare_with) {\n    return greater_than(value, compare_with, false)\n  },\n  '<': function (value, compare_with) {\n    return greater_than(compare_with, value, false)\n  },\n  '>~': function (value, compare_with) {\n    return greater_than(value, compare_with, true)\n  },\n  '<~': function (value, compare_with) {\n    return greater_than(compare_with, value, true)\n  },\n  '~': function (value, compare_with) {\n    return isEqual(compare_with, value[0], false)\n  },\n  '!~': function (value, compare_with) {\n    return isEqual(compare_with, value[0], true)\n  }\n}\n\nvar sorting = {\n  'string': function (value, compare_with, order) {\n    if (!order) order = 'asc'\n    // swap if 'desc'\n    if (order == 'desc')\n      value = [compare_with, compare_with = value][0]\n\n    return value.localeCompare(compare_with)\n  },\n  'number': function (value, compare_with, order) {\n    if (!order) order = 'asc'\n    // swap if 'desc'\n    if (order == 'desc')\n      value = [compare_with, compare_with = value][0]\n\n    return value - compare_with\n  }\n}\n\nfunction clone_pluck(source, include_keys, exclude_keys) {\n  if (include_keys.length == 0) include_keys = Object.keys(source)\n  var new_obj = {}\n  include_keys.forEach(function (key) {\n    if (exclude_keys.indexOf(key) < 0) new_obj[key] = source[key]\n  })\n  return new_obj\n}\n\n\n\nexport function datafilter(data, filters, dataset_name) {\n  filters = filters || []\n\n  var result = data\n  var operator, value\n\n  // url namespace sanitize\n  filters = namespace(filters, dataset_name)\n\n  var data_types = types(data, { convert: true })\n\n  // apply WHERE clause\n  for (var key in filters) {\n    if (key[0] == '_') continue\n    var operator_index = (key.match(/(!|>|>~|<|<~|~|!~)$/)) ? key.match(/(!|>|>~|<|<~|~|!~)$/).index : key.length\n    operator = (key.slice(operator_index) != '') ? key.slice(operator_index) : '='\n    value = (filters[key][0] != \"\") ? filters[key] : null\n\n    var col = key.slice(0, operator_index)\n    if (data_types[col] == 'number') {\n      value = value.map(function(val) { return parseFloat(val)})\n    } else if (data_types[col] == 'boolean') {\n      value = value.map(function(val){ return String(val) == 'true' ? true : false})\n    } else if (data_types[col] == 'date') {\n      value = value.map(function(val) { return Date.parse(val) })\n    }\n\n    result = result.filter(function (row) {\n      return (typeof row[col] != 'undefined') ? operators[operator](value, row[col]) : true\n    })\n  }\n\n  var offset = parseInt(filters['_offset']) || 0\n  var limit = parseInt(filters['_limit']) || 1000\n\n  result = result.slice(offset, (offset + limit))\n\n  // apply SELECT clause\n  if (filters['_c']) {\n    var exclude_cols = [], include_cols = []\n    filters['_c'].forEach(function (column) {\n      column[0] == '-' ? exclude_cols.push(column.slice(1)) : include_cols.push(column)\n    })\n    result = result.map(function (row) {\n      return clone_pluck(row, include_cols, exclude_cols)\n    })\n  }\n\n  if (filters['_sort']) {\n    result.sort(function (a, b) {\n      var swap_rows = false\n      filters['_sort'].forEach(function (sort) {\n        var order = (sort[0] == '-') ? 'desc' : 'asc'\n        if (sort[0] == '-') sort = sort.substr(1)\n        if (typeof a[sort] == 'undefined') return\n        // if sort.column evaluates to false, it will proceed with evaluating || expression\n        var type = (isNaN(a[sort])) ? 'string' : 'number'\n        swap_rows = swap_rows || sorting[type](a[sort], b[sort], order)\n      })\n      return swap_rows\n    })\n  }\n\n  return result\n}\n","// Import HTML sections as variables using rollup-plugin-htmlparts.js.\n// See rollup.config.js for usage.\n// Each <!-- var name --> section is imported as a minified variable string.\nimport * as default_templates from './formhandler.template.html'\nimport { parse } from './url.js'\nimport { namespace } from './namespace_util.js'\nimport { datafilter } from './datafilter.js'\n\n// Render components in this order. The empty component is the root component.\nvar components = ['', 'table', 'edit', 'add', 'page', 'size', 'count', 'export', 'filters', 'error', 'table_grid']\nvar default_options = {\n  table: true,\n  edit: false,\n  add: false,\n  page: true,\n  pageSize: 100,\n  size: true,\n  sizeValues: [10, 20, 50, 100, 500, 1000],\n  count: true,\n  export: true,\n  exportFormats: {\n    xlsx: 'Excel',\n    csv: 'CSV',\n    json: 'JSON',\n    html: 'HTML'\n  },\n  filters: true,\n  onhashchange: true\n}\nvar meta_headers = ['filters', 'ignored', 'excluded', 'sort', 'offset', 'limit', 'count']\n\nvar default_filters = {\n  text: { '': 'Equals...', '!': 'Does not equal...', '~': 'Contains...', '!~': 'Does not contain...' },\n  number: { '': 'Equals...', '!': 'Does not equal...', '<': 'Less than...', '>': 'Greater than...' },\n  date: { '': 'Equals...', '!': 'Does not equal...', '<': 'Before...', '>': 'After...' }\n}\n\n// Set default values for column specifications\n// function col_defaults(colinfo, data) {\nfunction col_defaults(colinfo) {\n  // Sort defaults\n  if (!('sort' in colinfo) || colinfo.sort === true)\n    colinfo.sort = { '': 'Sort ascending', '-': 'Sort descending' }\n  else if (typeof colinfo.sort != 'object')\n    colinfo.sort = {}\n\n  // Type defaults\n  colinfo.type = colinfo.type || 'text'\n\n  // Filters defaults\n  if (!('filters' in colinfo) || (colinfo.filters === true))\n    colinfo.filters = default_filters[colinfo.type]\n\n  // Hideable defaults\n  if (!('hideable' in colinfo))\n    colinfo.hideable = true\n\n  // Hide defaults\n  if (!('hide' in colinfo))\n    colinfo.hide = false\n}\n\n\nexport function formhandler(js_options) {\n  if (!js_options)\n    js_options = {}\n\n  this.each(function () {\n    var $this = $(this)\n    // Convert all .urlfilter classes into url filters that update location.hash\n    $this.urlfilter({\n      selector: '.urlfilter, .page-link',\n      target: '#',\n      remove: true                          // auto-remove empty values\n    })\n\n    // Pre-process options\n    var options = $.extend({}, default_options, js_options, $this.data())\n\n    if (!options.columns)\n      options.columns = []\n    else if (typeof options.columns == 'string')\n      options.columns = _.map(options.columns.split(/\\s*,\\s*/), function (col) { return { name: col } })\n\n    // Compile all templates\n    var template = {}\n    _.each(components, function (name) {\n      var tmpl = options[name ? name + 'Template' : 'template'] || default_templates['template_' + name] || 'NA'\n      template[name] = _.template(tmpl)\n    })\n\n    function draw_table(data, args, meta) {\n      // Add metadata\n      meta.rows = data.length\n      meta.columns = data.length ? _.map(data[0], function (val, col) { return { name: col } }) : []\n\n      // If any column name is '*', show all columns\n      var star_col = _.find(options.columns, function (o) { return o['name'] === '*' })\n      if (star_col) {\n        var action_header_cols = _.cloneDeep(meta.columns)\n        _.map(options.columns, function (option_col) {\n          var found = _.find(meta.columns, function (o) { return o['name'] === option_col.name })\n          if (!found && option_col.name !== '*')\n            action_header_cols.push(option_col)\n        })\n\n        action_header_cols = _.map(action_header_cols, function (col) {\n          var options_col = _.find(options.columns, function (o) { return o['name'] === col.name })\n          return options_col ? options_col : $.extend({}, star_col, col)\n        })\n      }\n\n      options.columns = action_header_cols ? action_header_cols : options.columns\n\n      // Render all components into respective targets\n      var template_data = {\n        data: data,\n        meta: meta,\n        args: args,\n        options: options,\n        idcount: 0,\n        parse: parse,\n        col_defaults: col_defaults,\n        isEdit: false,\n        isAdd: false,\n        templates: default_templates\n      }\n      // Store template_data in $this\n      $this.data('formhandler', template_data)\n\n      _.each(components, function (name) {\n        render_template(name, template_data, options, $this, template)\n      })\n      if (options.add)\n        addHandler($this, template_data, options, template)\n      if (options.edit)\n        editHandler($this, template_data, options, template)\n    }\n\n    function render() {\n      var url_args = parse(location.hash.replace(/^#/, '')).searchList\n      url_args = namespace(url_args, options.name)\n      // Create arguments passed to the FormHandler. Override with the user URL args\n      var args = _.extend({\n        c: options.columns.map(function (d) { return d.name }),\n        _limit: options.pageSize,\n        _format: 'json',\n        _meta: 'y'\n      }, url_args)\n      $('.loader', $this).removeClass('d-none')\n\n      function done(data, status, xhr) {\n        var meta = {}\n        _.each(meta_headers, function (header) {\n          var val = xhr ? xhr.getResponseHeader('Fh-Data-' + header) : null\n          if (val !== null)\n            meta[header] = JSON.parse(val)\n        })\n        if (typeof options.transform == 'function') {\n          var result = options.transform({ data: data, meta: meta, options: options, args: args }) || {}\n          data = 'data' in result ? result.data : data\n          meta = 'meta' in result ? result.meta : meta\n        }\n\n        // To support data-src that doesn't poin to formhandler url pattern\n        if (_.isEmpty(meta) && options.page && options.size) {\n          meta['offset'] = args._offset ? parseInt(args._offset) : 0\n          meta['limit'] = parseInt(args._limit)\n          meta['count'] = data.length\n          data = datafilter(data, args)\n        }\n\n        draw_table(data, args, meta)\n        $this.trigger({ type: 'load', formdata: data, meta: meta, args: args, options: options })\n      }\n\n      if (options.data && typeof (options.data) == 'object') {\n        options.edit = false\n        options.add = false\n        done(options.data)\n      }\n      else {\n        $.ajax(options.src, {\n          dataType: 'json',\n          data: args,\n          traditional: true\n        }).done(done)\n          .always(function () { $('.loader', $this).addClass('d-none') })\n          .fail(failHandler.bind(this, $this, template))\n      }\n    }\n\n    modalHandler($this)\n\n    actionHandler($this, options, template)\n\n    // Re-render every time the URL changes\n    if (options.onhashchange)\n      $(window).on('hashchange', render)\n    // Initialize\n    render()\n  })\n\n  return this\n}\n\nfunction modalHandler($this) {\n  //  Handle modal dialog\n  $this\n    .on('shown.bs.modal', '.formhandler-table-modal', function (e) {\n      var $el = $(e.relatedTarget)\n      var template_data = $this.data('formhandler')\n      var op = $el.data('op')\n      var col = $el.closest('[data-col]').data('col')\n      var val = ''\n      // If there is a value, show it, and allow user to remove the filter\n      if (template_data.args[col + op]) {\n        val = template_data.args[col + op].join(',')\n        $('.remove-action', this).attr('href', '?' + col + op + '=').show()\n      } else\n        $('.remove-action', this).hide()\n      $('input', this).val(val).attr('name', col + op).focus()\n      $('label', this).text($el.text())\n    })\n    .on('submit', 'form', function (e) {\n      e.preventDefault()\n      var filter = parse('?' + $(this).serialize()).searchKey\n      $(this).closest('.formhandler-table-modal').modal('hide')\n      window.location.hash = '#' + parse(location.hash.replace(/^#/, '')).update(filter)\n    })\n}\n\nfunction render_template(name, data, options, $this, template) {\n  // Disable components if required. But root component '' is always displayed\n  if (name && !options[name])\n    return\n\n  var target\n  // The root '' component is rendered into $this.\n  if (!name)\n    target = $this\n  else {\n    // Rest are rendered into .<component-name> under $this\n\n    if (options[name] == 'grid') name = 'table_grid'\n    var selector = options[name + 'Target'] || '.' + name\n    target = $(selector, $this)\n    // But if they don't exist, treat the selector as a global selecctor\n    if (target.length == 0)\n      target = $(selector)\n  }\n  target.html(template[name](data))\n}\n\n\nfunction addHandler($this, template_data, options, template) {\n\n  $('.add button', $this)\n    .on('click', function () {\n      var add_btn = $('.add button', $this)\n      var edit_btn = $('.edit button', $this)\n      if (add_btn.html().toLowerCase() == 'save') {\n        add_btn.html('Add')\n        edit_btn.prop('disabled', false)\n        var columns_data = $('.new-row td[data-key]')\n\n        $('.loader', $this).removeClass('d-none')\n        var data = {}\n\n        $.each(columns_data, function (key, column) {\n          data[column.getAttribute('data-key')] = $(column).children().val()\n        })\n        // if no changes made to new empty celled row, rerender the table.\n        if (!_.some(data)) {\n          $('.loader', $this).addClass('d-none')\n          template_data.isAdd = false\n          render_template('table', template_data, options, $this, template)\n          return\n        }\n\n        $.ajax(options.src, {\n          method: 'POST',\n          dataType: 'json',\n          data: data\n        }).done(function () {\n          template_data.data.unshift(data)\n          template_data.isAdd = false\n          render_template('table', template_data, options, $this, template)\n          if (options.add.done) options.add.done()\n        }).always(function () { $('.loader', $this).addClass('d-none') })\n          .fail(failHandler.bind(this, $this, template))\n      } else if (add_btn.html().toLowerCase() == 'add') {\n        add_btn.html('Save')\n        edit_btn.prop('disabled', true)\n        template_data.isAdd = true\n        render_template('table', template_data, options, $this, template)\n        add_edit_events($this, add_btn)\n      }\n    })\n}\n\nfunction editHandler($this, template_data, options, template) {\n  $('.edit button', $this)\n    .on('click', function () {\n      var edit_btn = $('.edit button', $this)\n      var add_btn = $('.add button', $this)\n      if (edit_btn.html().toLowerCase() == 'save') {\n        var edited_rows = $('.edited-row')\n        if (edited_rows.length > 0)\n          $('.loader', $this).removeClass('d-none')\n\n        var all_ajax = []\n        var allRowsValid = true\n        $.each(edited_rows, function (key, edited_row) {\n          var data = JSON.parse(edited_row.getAttribute('data-val'))\n          var rowIndex = edited_row.getAttribute('data-row')\n          for (key in data) {\n            // TODO: refactor to identify editable columns other than using data-key attrs on <td> tag\n            $('td[data-key=\"' + (remove_quotes(key)) + '\"] :input', edited_row).each(function() {\n              if (this.checkValidity()) {\n                $(this).removeClass('is-invalid')\n                data[key] = template_data['data'][rowIndex][key] = $(this).val()\n              } else {\n                $(this).addClass('is-invalid')\n                allRowsValid = false\n              }\n            })\n          }\n\n          all_ajax.push(\n            $.ajax(options.src, {\n              method: 'PUT',\n              dataType: 'json',\n              data: data\n            }).fail(failHandler.bind(this, $this, template))\n              .always(function () {\n                $('.loader', $this).addClass('d-none')\n                if (options.add.editFunction) options.add.editFunction()\n              })\n          )\n        })\n\n        if (!allRowsValid) return\n        $.when.apply($, all_ajax).then(function () {\n          $('.loader', $this).addClass('d-none')\n          edit_btn.html('Edit') // TODO: remove hardcoding of name Edit\n          add_btn.prop('disabled', false)\n          if (options.edit.done) options.edit.done()\n        })\n\n        template_data.isEdit = false\n        render_template('table', template_data, options, $this, template)\n      } else if (edit_btn.html().toLowerCase() == 'edit') {\n        edit_btn.html('Save') // TODO: remove hardcoding of name Save\n        add_btn.prop('disabled', true)\n        template_data.isEdit = true\n        render_template('table', template_data, options, $this, template)\n        add_edit_events($this, edit_btn)\n        $this.trigger({ type: 'editmode' })\n      }\n    })\n}\n\nfunction actionHandler($this, options, template) {\n  var default_actions = {\n    'delete': function (arg) {\n      return $.ajax(options.src, { method: 'DELETE', dataType: 'json', data: arg.row })\n        .done(function () { $('tr[data-row=\"' + arg.index + '\"]', $this).remove() })\n    }\n  }\n  $this.on('click', '[data-action]', function () {\n    var arg = {\n      row: $(this).closest('[data-val]').data('val'),\n      index: $(this).closest('[data-row]').data('row'),\n      notify: notify.bind(this, $this, template)\n    }\n    var action = $(this).data('action')\n\n    var method = (options.actions && (options.actions.filter(function (each_action) { return action in each_action }).length > 0))\n      ? options.actions.filter(function (each_action) { return action in each_action })[0][action]\n      : default_actions[action]\n\n    var deferred = method(arg)\n    if (deferred && deferred.always) {\n      $('.loader', $this).removeClass('d-none')\n      deferred\n        .always(function () { $('.loader', $this).addClass('d-none') })\n        .fail(failHandler.bind(this, $this, template))\n    }\n  })\n}\n\n\nfunction remove_quotes(str) {\n  return str.toString().replace(/[\"']/g, '')\n}\n\nfunction notify($this, template, message) {\n  var $note = $('.note', $this)\n  if (!$note.length)\n    $note = $('<div class=\"note\"></div>').appendTo($this)\n  $note.html(template['error']({ message: message }))\n}\n\nfunction failHandler($this, template, xhr, status, message) {\n  var error = status + ': ' + message\n  if (xhr.readyState == 0)\n    error += ' (cannot connect to server)'\n  notify($this, template, error)\n}\n\n\nfunction add_edit_events($this, save_btn) {\n  $('tbody :input', $this)\n    // When the user types something, mark the row as changed\n    .on('change', function () {\n      $(this).parents('tr').addClass('edited-row')\n    })\n    // When the user presses Enter, click on the \"Save\" button\n    .on('keypress', function (e) {\n      if (e.keyCode == 13) {\n        $(this).blur()      // Remove focus so that change / .edited-row is triggered\n        save_btn.trigger('click')\n      }\n    })\n    // Focus on the first element\n    .eq(0).focus()\n}\n","// jQuery utilities.\n// These are NOT jQuery plugins. They accept a $node directly.\n// These are NOT exposed as part of the API. Purely internal.\n\n// Return all values that match the selector\n// AMONG and UNDER the $node\nexport function findall($node, selector) {\n  return $node.filter(selector).add($node.find(selector))\n}\n\n// Return all values that DO NOT match the selector\n// AMONG and UNDER the $node. Complement of findall\nexport function notall($node, selector) {\n  return $node.not(selector).add($node.not(selector))\n}\n\n// Returns true if data attribute is present\n//    But if the value is \"false\", \"off\", \"n\" or \"no\" in any case, returns false (like YAML)\n// Returns default_value if data attribute is missing\nexport function hasdata($node, key, default_value) {\n  var val = $node.data(key)\n  if (typeof val == 'undefined' || val === false || val === null)\n    return default_value\n  if (typeof val == 'string' && val.match(/^(false|off|n|no)$/i))\n    return false\n  return true\n}\n\n// Return the {width:..., height:...} of the node\nexport function getSize($node) {\n  // Ideally, this is just one line:\n  //    return $node.getBoundingClientRect()\n\n  // But see http://stackoverflow.com/q/18153989/100904\n  // and https://bugzilla.mozilla.org/show_bug.cgi?id=530985\n  // If the contents exceed the bounds of an element,\n  // getBoundingClientRect() failes in Firefox.\n\n  // So set display:block, get $().width(), and unset display:block\n  $node = $($node)\n  var old_display = $node.css('display'),\n      result = {}\n  if (old_display != 'block')\n    $node.css('display', 'block')\n  result.width = $node.width()\n  result.height = $node.height()\n  if (old_display != 'block')\n    $node.css('display', old_display)\n  return result\n}\n","import { parse } from './url.js'\nimport { hasdata } from './_util.js'\n\nvar container_options = {\n  attr: 'href',\n  event: 'click change submit',\n  selector: '.urlfilter',\n  src: 'src'\n}\nvar event_namespace =  '.urlfilter'\n\nexport function urlfilter(options) {\n  var $self = this\n  // If there are no elements in the selection, exit silently\n  if ($self.length == 0)\n    return\n  var doc = $self[0].ownerDocument\n  var settings = $.extend({}, container_options, options || {}, this.dataset)\n  var default_remove = settings.remove || hasdata($self, 'remove')\n  var events = settings.event.split(/\\s+/).map(function (v) { return v + event_namespace }).join(' ')\n  // options.location and options.history are used purely for testing\n  var loc = settings.location || (doc.defaultView || doc.parentWindow).location\n  var hist = settings.history || (doc.defaultView || doc.parentWindow).history\n  return $self\n    .on(events, settings.selector, function (e) {\n      var $this = $(this),\n          mode = $this.data('mode') || settings.mode,\n          target = $this.data('target') || settings.target,\n          src = $this.data('src') || settings.src,\n          remove = hasdata($this, 'remove', default_remove),\n          href\n      if (e.type == 'change' || $(e.target).is(':input:not(:button)')) {\n        var key = encodeURIComponent($this.attr('id') || $this.attr('name'))\n        var val = encodeURIComponent($this.val())\n        href = '?' + key + '=' + val\n      }\n      else if (e.type == 'submit' || $(e.target).is('form')) {\n        e.preventDefault()\n        href = '?' + $this.serialize()\n      }\n      else if (e.type == 'click') {\n        if ($(e.target).is('a'))\n          e.preventDefault()\n        href = $this.attr(settings.attr)\n      } else\n        return\n\n      var url = parse(href),\n          q = url.searchList\n\n      function target_url(url) {\n        var result = parse(url)\n          .join(href, { query: false, hash: false })\n          .update(q, mode)\n        if (remove) {\n          var missing_keys = {}\n          for (var key in result.searchKey)\n            if (result.searchKey[key] === '')\n              missing_keys[key] = null\n          result.update(missing_keys)\n        }\n        return result.toString()\n      }\n\n      // If the target is...       the URL is get/set at\n      // ------------------------  ---------------------\n      // unspecified (=> window)   location.href\n      // 'pushState'               location.href\n      // '#'                       location.hash\n      // anything else             $(target).data(src)\n      if (!target)\n        loc.href = target_url(loc.href)\n      else if (target == '#')\n        loc.hash = target_url(loc.hash.replace(/^#/, ''))\n      else if (target.match(/^pushstate$/i))\n        hist.pushState({}, '', target_url(loc.href))\n      else {\n        $(target).each(function () {\n          var $target = $(this)\n          var url = target_url($target.attr(src))\n          $target.attr(src, url).load(url, function () {\n            $target.trigger({ type: 'load', url: url })\n          })\n        })\n      }\n      $this.trigger({ type: 'urlfilter', url: url })\n    })\n}\n","export { version } from './src/package.js'\nimport { parse, unparse, join, update } from './src/url.js'\n\nexport var url = {\n  parse: parse,\n  unparse: unparse,\n  join: join,\n  update: update\n}\n\nimport { urlfilter } from './src/urlfilter.js'\n\nif (typeof jQuery != 'undefined') {\n  jQuery.extend(jQuery.fn, {\n    urlfilter: urlfilter\n  })\n}\n","export { version } from './src/package.js'\nimport { formhandler } from './src/formhandler.js'\n// FormHandler requires $().urlfilter\nexport { url } from './index-urlfilter.js'\n\nif (typeof jQuery != 'undefined') {\n  jQuery.extend(jQuery.fn, {\n    formhandler: formhandler\n  })\n}\n","export var name = \"g1\";\r\nexport var version = \"0.17.3\";\r\nexport var description = \"Gramex 1.x interaction library\";\r\nexport var license = \"MIT\";\r\nexport var author = \"S Anand <s.anand@gramener.com>\";\r\nexport var module = \"modules.js\";\r\nexport var main = \"dist/g1.js\";\r\nexport var jsdelivr = \"dist/g1.min.js\";\r\nexport var unpkg = \"dist/g1.min.js\";\r\nexport var repository = {\"type\":\"git\",\"url\":\"git@code.gramener.com:s.anand/g1.git\"};\r\nexport var scripts = {\"lint\":\"eslint index*.js src && eclint check '**/*.html' '**/*.js' '**/*.css' '**/*.yaml' '**/*.md'\",\"build\":\"rimraf dist && json2module package.json > src/package.js && rollup -c\",\"dev\":\"rimraf dist && json2module package.json > src/package.js && rollup -c -w\",\"pretest\":\"npm run lint && npm run build && browserify -s tape -r tape -o test/tape.js\",\"server\":\"npm run pretest && npm run lint && node test/server.js\",\"test\":\"tape test/test-*.js | faucet && node test/server.js puppeteer | tap-merge | faucet\",\"test-chrome\":\"node test/server.js chrome | tap-merge | faucet\",\"test-edge\":\"node test/server.js MicrosoftEdge | tap-merge | faucet\",\"test-firefox\":\"node test/server.js firefox | tap-merge | faucet\",\"prepublishOnly\":\"npm test\"};\r\nexport var devDependencies = {\"babel-core\":\"6\",\"babel-plugin-external-helpers\":\"6\",\"babel-plugin-transform-runtime\":\"6\",\"babel-preset-env\":\"1\",\"babel-preset-es2015\":\"6\",\"babelrc-rollup\":\"3\",\"bootstrap\":\"4.1\",\"bootstrap-select\":\"1.13\",\"browserify\":\"14\",\"component-emitter\":\"1\",\"d3\":\"4\",\"d3-scale-chromatic\":\"1\",\"deepmerge\":\"2\",\"eclint\":\"2\",\"es6-promise\":\"4\",\"eslint\":\"4\",\"events-polyfill\":\"2\",\"express\":\"4\",\"faucet\":\"0.0\",\"font-awesome\":\"4\",\"glob\":\"7.1\",\"html-minifier\":\"3\",\"is-plain-object\":\"2\",\"jquery\":\"3\",\"json2module\":\"0.0\",\"leaflet\":\"1.3\",\"lodash\":\"4\",\"moment\":\"2\",\"morphdom\":\"2\",\"numeral\":\"2\",\"popper.js\":\"1\",\"puppeteer\":\"0.13\",\"regenerator-runtime\":\"0.11\",\"rimraf\":\"2\",\"rollup\":\"1\",\"rollup-plugin-babel\":\"3\",\"rollup-plugin-commonjs\":\"10\",\"rollup-plugin-node-resolve\":\"5\",\"rollup-plugin-uglify\":\"6\",\"rollup-pluginutils\":\"2\",\"selenium-webdriver\":\"3\",\"tap-merge\":\"0.3\",\"tape\":\"4\",\"topojson\":\"3\",\"unfetch\":\"3\"};\r\nexport var dependencies = {\"d3-array\":\"2\",\"lodash-es\":\"4\"};\r\n"],"names":["_url_parse_key","_url_parse_qname","_url_parse_strict","_url_parse_search","_decode_uri_component","s","decodeURIComponent","replace","_encode_uri_component","encodeURIComponent","parse","str","uri","toString","unparse","join","update","m","exec","i","search_key","search_list","$0","key","val","push","self","vals","l","protocol","this","username","password","hostname","port","pathname","search","hash","parts","qparts","length","urlstr","options","frag","sources","split","ptr","url","targets","query","path","slice","relative","args","mode","search_list_key","result","modes","match","searchKey","Array","isArray","concat","namespace","name","state_transitions","null","state","date","number","boolean","string","object","mixed","end","undefined","default","isEqual","value","compare_with","criteria_satisfied","indexOf","greater_than","include_equals","isNaN","Date","operators","=","!",">","<",">~","<~","~","!~","sorting","order","localeCompare","datafilter","data","filters","dataset_name","operator","data_types","convert","limit","ignore","columns","Object","keys","columnIndex","column","result_type","index","row","forEach","type","parseFloat","isFinite","state_transition","change","types","operator_index","col","map","String","filter","offset","parseInt","exclude_cols","include_cols","source","include_keys","exclude_keys","new_obj","clone_pluck","sort","a","b","swap_rows","substr","components","default_options","table","edit","add","page","pageSize","size","sizeValues","count","export","exportFormats","xlsx","csv","json","html","onhashchange","meta_headers","default_filters","text","col_defaults","colinfo","-","hideable","hide","render_template","$this","template","target","selector","$","notify","message","$note","appendTo","failHandler","xhr","status","error","readyState","add_edit_events","save_btn","on","parents","addClass","e","keyCode","blur","trigger","eq","focus","hasdata","$node","default_value","container_options","attr","event","src","jQuery","extend","fn","urlfilter","doc","ownerDocument","settings","dataset","default_remove","remove","events","v","loc","location","defaultView","parentWindow","hist","history","href","is","preventDefault","serialize","q","searchList","target_url","missing_keys","pushState","each","$target","load","formhandler","js_options","_","draw_table","meta","rows","star_col","find","o","action_header_cols","cloneDeep","option_col","options_col","template_data","idcount","isEdit","isAdd","templates","default_templates","add_btn","edit_btn","toLowerCase","prop","columns_data","removeClass","getAttribute","children","some","ajax","method","dataType","done","unshift","always","fail","bind","addHandler","edited_rows","all_ajax","allRowsValid","edited_row","JSON","rowIndex","checkValidity","editFunction","when","apply","then","editHandler","render","url_args","c","d","_limit","_format","_meta","header","getResponseHeader","transform","isEmpty","_offset","formdata","traditional","tmpl","$el","relatedTarget","op","closest","show","modal","window","modalHandler","default_actions","delete","arg","action","deferred","actions","each_action","actionHandler"],"mappings":"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"}