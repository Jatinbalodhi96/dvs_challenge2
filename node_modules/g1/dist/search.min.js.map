{"version":3,"file":"search.min.js","sources":["../src/search.js","../index-search.js","../src/package.js"],"sourcesContent":["// data- attribute to store the last performed search\nvar _lastsearch_attr = 'search-last'\n// data- attribute to store granular search results\nvar _search_results = 'search-results'\n\nvar container_options = {\n  selector: '[data-search]',\n  hideClass: '',\n  showClass: '',\n  transform: 'strip',\n  change: 'words',\n}\n\nexport function search(options) {\n  var settings = $.extend({}, container_options, options, this.data())\n  this\n    .off('.g.search')\n    .on('keyup.g.search change.g.search', settings.selector, run_search)\n    .on('refresh.g.search', refresh)\n    .on('search.g.search', function (e) {\n      refresh(e)\n      run_search(e)\n    })\n  // If the container *IS* the trigger, run search\n  this.filter(settings.selector)\n    .on('keyup.g.search change.g.search', run_search)\n  return this\n\n  // Extract & transform search strings. Cache in input's dataset.search_results\n  // Return the search strings.\n  function refresh(e) {\n    var opts = $.extend({}, settings, e.target.dataset)\n    var search_text = opts.search == '@text' ?\n      function (el) { return el.textContent } :\n      function (el) { return el.getAttribute(opts.search) }\n    var transform = search.transforms[opts.transform]\n    var result = $(opts.target).map(function() {\n      var s = search_text(this)\n      return { el: $(this), original: s, text: transform(s), show: true }\n    }).get()\n    $(e.target).data(_search_results, result)\n      .removeData(_lastsearch_attr)\n    return result\n  }\n\n  function run_search(e) {\n    var opts = $.extend({}, settings, e.target.dataset)\n    var $el = $(e.target)\n    var out = {\n      type: 'shown.g.search',\n      searchText: $el.val()\n    }\n    out.search = search.changes[opts.change](search.transforms[opts.transform](out.searchText))\n    var lastsearch = $el.data(_lastsearch_attr)\n    if (lastsearch == out.search)\n      return\n    $el.data(_lastsearch_attr, out.search)\n\n    var hidecls = opts.hideClass,\n        showcls = opts.showClass,\n        re = new RegExp(out.search || '.*')\n    out.results = $el.data(_search_results) || refresh(e)\n    out.matches = out.results.length\n    out.results.forEach(function (cell) {\n      var show = cell.text.match(re)\n      if (show !== cell.show) {\n        if (hidecls) cell.el[!show ? 'addClass' : 'removeClass'](hidecls)\n        if (showcls) cell.el[show ? 'addClass' : 'removeClass'](showcls)\n        cell.show = show\n      }\n      if (!show) out.matches--\n    })\n    $el.trigger(out)\n  }\n}\n\nsearch.transforms = {\n  strip: function (s) { return (s || '').toLowerCase().replace(/\\s+/g, ' ').replace(/^ /, '').replace(/ $/, '') }\n}\nsearch.changes = {\n  words: function (s) { return s.replace(/\\s+/g, '.*') }\n}\n","export { version } from './src/package.js'\nimport { search } from './src/search.js'\n\nif (typeof jQuery != 'undefined') {\n  jQuery.extend(jQuery.fn, {\n    search: search\n  })\n}\n","export var name = \"g1\";\r\nexport var version = \"0.17.3\";\r\nexport var description = \"Gramex 1.x interaction library\";\r\nexport var license = \"MIT\";\r\nexport var author = \"S Anand <s.anand@gramener.com>\";\r\nexport var module = \"modules.js\";\r\nexport var main = \"dist/g1.js\";\r\nexport var jsdelivr = \"dist/g1.min.js\";\r\nexport var unpkg = \"dist/g1.min.js\";\r\nexport var repository = {\"type\":\"git\",\"url\":\"git@code.gramener.com:s.anand/g1.git\"};\r\nexport var scripts = {\"lint\":\"eslint index*.js src && eclint check '**/*.html' '**/*.js' '**/*.css' '**/*.yaml' '**/*.md'\",\"build\":\"rimraf dist && json2module package.json > src/package.js && rollup -c\",\"dev\":\"rimraf dist && json2module package.json > src/package.js && rollup -c -w\",\"pretest\":\"npm run lint && npm run build && browserify -s tape -r tape -o test/tape.js\",\"server\":\"npm run pretest && npm run lint && node test/server.js\",\"test\":\"tape test/test-*.js | faucet && node test/server.js puppeteer | tap-merge | faucet\",\"test-chrome\":\"node test/server.js chrome | tap-merge | faucet\",\"test-edge\":\"node test/server.js MicrosoftEdge | tap-merge | faucet\",\"test-firefox\":\"node test/server.js firefox | tap-merge | faucet\",\"prepublishOnly\":\"npm test\"};\r\nexport var devDependencies = {\"babel-core\":\"6\",\"babel-plugin-external-helpers\":\"6\",\"babel-plugin-transform-runtime\":\"6\",\"babel-preset-env\":\"1\",\"babel-preset-es2015\":\"6\",\"babelrc-rollup\":\"3\",\"bootstrap\":\"4.1\",\"bootstrap-select\":\"1.13\",\"browserify\":\"14\",\"component-emitter\":\"1\",\"d3\":\"4\",\"d3-scale-chromatic\":\"1\",\"deepmerge\":\"2\",\"eclint\":\"2\",\"es6-promise\":\"4\",\"eslint\":\"4\",\"events-polyfill\":\"2\",\"express\":\"4\",\"faucet\":\"0.0\",\"font-awesome\":\"4\",\"glob\":\"7.1\",\"html-minifier\":\"3\",\"is-plain-object\":\"2\",\"jquery\":\"3\",\"json2module\":\"0.0\",\"leaflet\":\"1.3\",\"lodash\":\"4\",\"moment\":\"2\",\"morphdom\":\"2\",\"numeral\":\"2\",\"popper.js\":\"1\",\"puppeteer\":\"0.13\",\"regenerator-runtime\":\"0.11\",\"rimraf\":\"2\",\"rollup\":\"1\",\"rollup-plugin-babel\":\"3\",\"rollup-plugin-commonjs\":\"10\",\"rollup-plugin-node-resolve\":\"5\",\"rollup-plugin-uglify\":\"6\",\"rollup-pluginutils\":\"2\",\"selenium-webdriver\":\"3\",\"tap-merge\":\"0.3\",\"tape\":\"4\",\"topojson\":\"3\",\"unfetch\":\"3\"};\r\nexport var dependencies = {\"d3-array\":\"2\",\"lodash-es\":\"4\"};\r\n"],"names":["_lastsearch_attr","_search_results","container_options","selector","hideClass","showClass","transform","change","search","options","settings","$","extend","this","data","off","on","run_search","refresh","e","filter","opts","target","dataset","search_text","el","textContent","getAttribute","transforms","result","map","s","original","text","show","get","removeData","$el","out","type","searchText","val","changes","hidecls","showcls","re","RegExp","results","matches","length","forEach","cell","match","trigger","strip","toLowerCase","replace","words","jQuery","fn"],"mappings":"yMACIA,EAAmB,cAEnBC,EAAkB,iBAElBC,EAAoB,CACtBC,SAAU,gBACVC,UAAW,GACXC,UAAW,GACXC,UAAW,QACXC,OAAQ,SAGH,SAASC,EAAOC,GACrB,IAAIC,EAAWC,EAAEC,OAAO,GAAIV,EAAmBO,EAASI,KAAKC,QAY7D,OAXAD,KACGE,IAAI,aACJC,GAAG,iCAAkCN,EAASP,SAAUc,GACxDD,GAAG,mBAAoBE,GACvBF,GAAG,kBAAmB,SAAUG,GAC/BD,EAAQC,GACRF,EAAWE,KAGfN,KAAKO,OAAOV,EAASP,UAClBa,GAAG,iCAAkCC,GACjCJ,KAIP,SAASK,EAAQC,GACf,IAAIE,EAAOV,EAAEC,OAAO,GAAIF,EAAUS,EAAEG,OAAOC,SACvCC,EAA6B,SAAfH,EAAKb,OACrB,SAAUiB,GAAM,OAAOA,EAAGC,aAC1B,SAAUD,GAAM,OAAOA,EAAGE,aAAaN,EAAKb,SAC1CF,EAAYE,EAAOoB,WAAWP,EAAKf,WACnCuB,EAASlB,EAAEU,EAAKC,QAAQQ,IAAI,WAC9B,IAAIC,EAAIP,EAAYX,MACpB,MAAO,CAAEY,GAAId,EAAEE,MAAOmB,SAAUD,EAAGE,KAAM3B,EAAUyB,GAAIG,MAAM,KAC5DC,MAGH,OAFAxB,EAAEQ,EAAEG,QAAQR,KAAKb,EAAiB4B,GAC/BO,WAAWpC,GACP6B,EAGT,SAASZ,EAAWE,GAClB,IAAIE,EAAOV,EAAEC,OAAO,GAAIF,EAAUS,EAAEG,OAAOC,SACvCc,EAAM1B,EAAEQ,EAAEG,QACVgB,EAAM,CACRC,KAAM,iBACNC,WAAYH,EAAII,OAIlB,GAFAH,EAAI9B,OAASA,EAAOkC,QAAQrB,EAAKd,QAAQC,EAAOoB,WAAWP,EAAKf,WAAWgC,EAAIE,aAC9DH,EAAIvB,KAAKd,IACRsC,EAAI9B,OAAtB,CAEA6B,EAAIvB,KAAKd,EAAkBsC,EAAI9B,QAE/B,IAAImC,EAAUtB,EAAKjB,UACfwC,EAAUvB,EAAKhB,UACfwC,EAAK,IAAIC,OAAOR,EAAI9B,QAAU,MAClC8B,EAAIS,QAAUV,EAAIvB,KAAKb,IAAoBiB,EAAQC,GACnDmB,EAAIU,QAAUV,EAAIS,QAAQE,OAC1BX,EAAIS,QAAQG,QAAQ,SAAUC,GAC5B,IAAIjB,EAAOiB,EAAKlB,KAAKmB,MAAMP,GACvBX,IAASiB,EAAKjB,OACZS,GAASQ,EAAK1B,GAAIS,EAAoB,cAAb,YAA4BS,GACrDC,GAASO,EAAK1B,GAAGS,EAAO,WAAa,eAAeU,GACxDO,EAAKjB,KAAOA,GAETA,GAAMI,EAAIU,YAEjBX,EAAIgB,QAAQf,KAIhB9B,EAAOoB,WAAa,CAClB0B,MAAO,SAAUvB,GAAK,OAAQA,GAAK,IAAIwB,cAAcC,QAAQ,OAAQ,KAAKA,QAAQ,KAAM,IAAIA,QAAQ,KAAM,MAE5GhD,EAAOkC,QAAU,CACfe,MAAO,SAAU1B,GAAK,OAAOA,EAAEyB,QAAQ,OAAQ,QC7E5B,oBAAVE,QACTA,OAAO9C,OAAO8C,OAAOC,GAAI,CACvBnD,OAAQA,cCJS"}