{"version":3,"file":"types.min.js","sources":["../src/types.js","../src/package.js"],"sourcesContent":["// state_transition[old_state][current_type] -> new_state\n// type: undefined and type: null are mapped to state 'null', i.e. missing values\nvar state_transitions = {\n  'null': {\n    'null': { state: 'null' },\n    'date': { state: 'date' },\n    'number': { state: 'number' },\n    'boolean': { state: 'boolean' },\n    'string': { state: 'string' },\n    'object': { state: 'object' },\n    'mixed': { state: 'mixed', end: true }\n  },\n  'date': {\n    'null': { state: 'date' },\n    'undefined': { state: 'date' },\n    'date': { state: 'date' },\n    'default': { state: 'mixed', end: true }\n  },\n  'number': {\n    'null': { state: 'number' },\n    'undefined': { state: 'number' },\n    'number': { state: 'number' },\n    'default': { state: 'mixed', end: true }\n  },\n  'boolean': {\n    'null': { state: 'boolean' },\n    'undefined': { state: 'boolean' },\n    'boolean': { state: 'boolean' },\n    'default': { state: 'mixed', end: true }\n  },\n  'string': {\n    'null': { state: 'string' },\n    'undefined': { state: 'string' },\n    'string': { state: 'string' },\n    'default': { state: 'mixed', end: true }\n  },\n  'object': {\n    'null': { state: 'object' },\n    'object': { state: 'object' },\n    'undefined': { state: 'object' },\n    'default': { state: 'mixed', end: true }\n  },\n  'mixed': {\n    'default': { state: 'mixed', end: true }\n  }\n}\n\n\nexport function types(data, options) {\n  var result = {}\n  if (!data || !data.length)\n    return result\n\n  options = options || {}\n  options.convert = options.convert || false\n  options.limit = options.limit || 1000\n  var limit = (options.limit < data.length) ? options.limit : data.length\n  var ignore = options.ignore = options.ignore || [null, undefined]\n  var columns = Object.keys(data[0])\n\n  for (var columnIndex = 0; columnIndex < columns.length; columnIndex++) {\n    var column = columns[columnIndex]\n    var result_type = 'null'\n    for (var index = 0; index < limit; index++) {\n      var row = data[index]\n      var value = row[column]\n\n      if (columnIndex == 0) {\n        Object.keys(data[index]).forEach(function (value) {\n          if (columns.indexOf(value) == -1)\n            columns.push(value)\n        })\n      }\n\n      // Ignore if the value is missing\n      if (!(column in row))\n        continue\n      // Ignore values that are in the ignore list\n      if (ignore.indexOf(value) >= 0)\n        continue\n      // Identify type (date, object, number, boolean, string, undefined, null)\n      var type = typeof value\n      if (value === undefined || value === null)\n        type = 'null'\n      else if (type == 'object' && !isNaN(Date.parse(value)))\n        type = 'date'\n      else if (options.convert) {\n        // We use parseFloat AND isFinite because\n        // parseFloat('2018-01') is 2018 but isFinite('2018-01') is false\n        // Also, 'NaN', 'Infinity' and '-Infinity' should be treated as numbers\n        if ((!isNaN(parseFloat(value)) && isFinite(value)) || ['NaN', 'Infinity', '-Infinity'].indexOf(value) >= 0)\n          type = 'number'\n        else if (!isNaN(Date.parse(value)))\n          type = 'date'\n        else if (['true', 'false'].indexOf(value) != -1)\n          type = 'boolean'\n      }\n\n      // Apply the state change\n      var state_transition = state_transitions[type]\n      var change = state_transition[result_type] || state_transition['default']\n      result_type = change['state']\n      if (change['end'])\n        break\n    }\n    result[column] = result_type\n  }\n  return result\n}\n","export var name = \"g1\";\r\nexport var version = \"0.17.3\";\r\nexport var description = \"Gramex 1.x interaction library\";\r\nexport var license = \"MIT\";\r\nexport var author = \"S Anand <s.anand@gramener.com>\";\r\nexport var module = \"modules.js\";\r\nexport var main = \"dist/g1.js\";\r\nexport var jsdelivr = \"dist/g1.min.js\";\r\nexport var unpkg = \"dist/g1.min.js\";\r\nexport var repository = {\"type\":\"git\",\"url\":\"git@code.gramener.com:s.anand/g1.git\"};\r\nexport var scripts = {\"lint\":\"eslint index*.js src && eclint check '**/*.html' '**/*.js' '**/*.css' '**/*.yaml' '**/*.md'\",\"build\":\"rimraf dist && json2module package.json > src/package.js && rollup -c\",\"dev\":\"rimraf dist && json2module package.json > src/package.js && rollup -c -w\",\"pretest\":\"npm run lint && npm run build && browserify -s tape -r tape -o test/tape.js\",\"server\":\"npm run pretest && npm run lint && node test/server.js\",\"test\":\"tape test/test-*.js | faucet && node test/server.js puppeteer | tap-merge | faucet\",\"test-chrome\":\"node test/server.js chrome | tap-merge | faucet\",\"test-edge\":\"node test/server.js MicrosoftEdge | tap-merge | faucet\",\"test-firefox\":\"node test/server.js firefox | tap-merge | faucet\",\"prepublishOnly\":\"npm test\"};\r\nexport var devDependencies = {\"babel-core\":\"6\",\"babel-plugin-external-helpers\":\"6\",\"babel-plugin-transform-runtime\":\"6\",\"babel-preset-env\":\"1\",\"babel-preset-es2015\":\"6\",\"babelrc-rollup\":\"3\",\"bootstrap\":\"4.1\",\"bootstrap-select\":\"1.13\",\"browserify\":\"14\",\"component-emitter\":\"1\",\"d3\":\"4\",\"d3-scale-chromatic\":\"1\",\"deepmerge\":\"2\",\"eclint\":\"2\",\"es6-promise\":\"4\",\"eslint\":\"4\",\"events-polyfill\":\"2\",\"express\":\"4\",\"faucet\":\"0.0\",\"font-awesome\":\"4\",\"glob\":\"7.1\",\"html-minifier\":\"3\",\"is-plain-object\":\"2\",\"jquery\":\"3\",\"json2module\":\"0.0\",\"leaflet\":\"1.3\",\"lodash\":\"4\",\"moment\":\"2\",\"morphdom\":\"2\",\"numeral\":\"2\",\"popper.js\":\"1\",\"puppeteer\":\"0.13\",\"regenerator-runtime\":\"0.11\",\"rimraf\":\"2\",\"rollup\":\"1\",\"rollup-plugin-babel\":\"3\",\"rollup-plugin-commonjs\":\"10\",\"rollup-plugin-node-resolve\":\"5\",\"rollup-plugin-uglify\":\"6\",\"rollup-pluginutils\":\"2\",\"selenium-webdriver\":\"3\",\"tap-merge\":\"0.3\",\"tape\":\"4\",\"topojson\":\"3\",\"unfetch\":\"3\"};\r\nexport var dependencies = {\"d3-array\":\"2\",\"lodash-es\":\"4\"};\r\n"],"names":["state_transitions","null","state","date","number","boolean","string","object","mixed","end","undefined","default","data","options","result","length","convert","limit","ignore","columns","Object","keys","columnIndex","column","result_type","index","row","value","forEach","indexOf","push","type","isNaN","Date","parse","parseFloat","isFinite","state_transition","change"],"mappings":"yMAEIA,EAAoB,CACtBC,KAAQ,CACNA,KAAQ,CAAEC,MAAO,QACjBC,KAAQ,CAAED,MAAO,QACjBE,OAAU,CAAEF,MAAO,UACnBG,QAAW,CAAEH,MAAO,WACpBI,OAAU,CAAEJ,MAAO,UACnBK,OAAU,CAAEL,MAAO,UACnBM,MAAS,CAAEN,MAAO,QAASO,KAAK,IAElCN,KAAQ,CACNF,KAAQ,CAAEC,MAAO,QACjBQ,UAAa,CAAER,MAAO,QACtBC,KAAQ,CAAED,MAAO,QACjBS,QAAW,CAAET,MAAO,QAASO,KAAK,IAEpCL,OAAU,CACRH,KAAQ,CAAEC,MAAO,UACjBQ,UAAa,CAAER,MAAO,UACtBE,OAAU,CAAEF,MAAO,UACnBS,QAAW,CAAET,MAAO,QAASO,KAAK,IAEpCJ,QAAW,CACTJ,KAAQ,CAAEC,MAAO,WACjBQ,UAAa,CAAER,MAAO,WACtBG,QAAW,CAAEH,MAAO,WACpBS,QAAW,CAAET,MAAO,QAASO,KAAK,IAEpCH,OAAU,CACRL,KAAQ,CAAEC,MAAO,UACjBQ,UAAa,CAAER,MAAO,UACtBI,OAAU,CAAEJ,MAAO,UACnBS,QAAW,CAAET,MAAO,QAASO,KAAK,IAEpCF,OAAU,CACRN,KAAQ,CAAEC,MAAO,UACjBK,OAAU,CAAEL,MAAO,UACnBQ,UAAa,CAAER,MAAO,UACtBS,QAAW,CAAET,MAAO,QAASO,KAAK,IAEpCD,MAAS,CACPG,QAAW,CAAET,MAAO,QAASO,KAAK,aAK/B,SAAeG,EAAMC,GAC1B,IAAIC,EAAS,GACb,IAAKF,IAASA,EAAKG,OACjB,OAAOD,GAETD,EAAUA,GAAW,IACbG,QAAUH,EAAQG,UAAW,EACrCH,EAAQI,MAAQJ,EAAQI,OAAS,IAKjC,IAJA,IAAIA,EAASJ,EAAQI,MAAQL,EAAKG,OAAUF,EAAQI,MAAQL,EAAKG,OAC7DG,EAASL,EAAQK,OAASL,EAAQK,QAAU,CAAC,UAAMR,GACnDS,EAAUC,OAAOC,KAAKT,EAAK,IAEtBU,EAAc,EAAGA,EAAcH,EAAQJ,OAAQO,IAAe,CAGrE,IAFA,IAAIC,EAASJ,EAAQG,GACjBE,EAAc,OACTC,EAAQ,EAAGA,EAAQR,EAAOQ,IAAS,CAC1C,IAAIC,EAAMd,EAAKa,GACXE,EAAQD,EAAIH,GAUhB,GARmB,GAAfD,GACFF,OAAOC,KAAKT,EAAKa,IAAQG,QAAQ,SAAUD,IACV,GAA3BR,EAAQU,QAAQF,IAClBR,EAAQW,KAAKH,KAKbJ,KAAUG,KAGa,GAAzBR,EAAOW,QAAQF,IAAnB,CAGA,IAAII,SAAcJ,EACdA,MAAAA,EACFI,EAAO,OACQ,UAARA,GAAqBC,MAAMC,KAAKC,MAAMP,IAEtCd,EAAQG,WAITgB,MAAMG,WAAWR,KAAWS,SAAST,IAA8D,GAAnD,CAAC,MAAO,WAAY,aAAaE,QAAQF,GAC7FI,EAAO,SACCC,MAAMC,KAAKC,MAAMP,KAEmB,GAArC,CAAC,OAAQ,SAASE,QAAQF,KACjCI,EAAO,WAFPA,EAAO,QARTA,EAAO,OAcT,IAAIM,EAAmBrC,EAAkB+B,GACrCO,EAASD,EAAiBb,IAAgBa,EAA0B,QAExE,GADAb,EAAcc,EAAc,MACxBA,EAAY,IACd,OAEJxB,EAAOS,GAAUC,EAEnB,OAAOV,aC1GY"}